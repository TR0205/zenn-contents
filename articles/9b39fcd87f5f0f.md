---
title: "ã€Kubernetesã€‘Redocã‚³ãƒ³ãƒ†ãƒŠã‚’æŒã¤Podã‚’ä½œæˆã™ã‚‹"
emoji: "ğŸ˜Š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Docker", "Kubernetes", "Redoc"]
published: true
---

# æ¦‚è¦
Redocã‚³ãƒ³ãƒ†ãƒŠã‚’æŒã¤Podã‚’ä½œæˆã—ã‚ˆã†ã¨æ€ã£ãŸã‚‰ã€ãƒ‘ã‚¹ã®æŒ‡å®šã¨ã‹Volumeã®ä½¿ã„æ–¹ã§è‰²ã€…è©°ã¾ã£ãŸã®ã§ãƒ¡ãƒ¢

# ã‚³ãƒ¼ãƒ‰
## Deployment
```yaml:deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: api-redoc
  name: api-openapi-redoc
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api-redoc
  template:
    metadata:
      labels:
        app: api-redoc
    spec:
      containers:
      - image: redocly/redoc:v2.1.4
        name: redoc
        env:
        - name: SPEC_URL
          value: ./openapi/api.yaml # ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰è¦‹ãŸyamlã®å ´æ‰€
        ports:
        - containerPort: 80
          protocol: TCP
        resources:
          limits:
            cpu: 100m
          requests:
            cpu: 100m
        volumeMounts:
        - name: openapidoc # volumes.nameã‚’æŒ‡å®š
          # ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª(/usr/share/nginx/html/)ã®ä¸‹ã«openapi/ã‚’ä½œæˆã—ãƒã‚¦ãƒ³ãƒˆ
          mountPath: /usr/share/nginx/html/openapi
      volumes:
      - name: openapidoc
        configMap:
          name: api-openapi-docs

```

## Volumeã®æŒ‡å®š
volumeMounts.mountPathã§ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã€volumesã§æŒ‡å®šã—ãŸãƒœãƒªãƒ¥ãƒ¼ãƒ ã¨ãƒã‚¦ãƒ³ãƒˆ

yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚¦ãƒ³ãƒˆã—ãŸã‚‰èª­ã¿è¾¼ã‚ãšã€ã‚ˆãè¦‹ãŸã‚‰.yamlã¨ã„ã†åã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãªã£ã¦ã„ãŸã€‚
404ã‚¨ãƒ©ãƒ¼ã§ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã‹ã‚‰OKã€ã§ã¯ãªãls -lFã‚„catã§ä¸­èº«ã¾ã§ç¢ºèªã—ãªã‘ã‚Œã°ã ã‚

## SPEC_URL
ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª(/usr/share/nginx/html/)ã‹ã‚‰è¦‹ãŸyaml or jsonã®å ´æ‰€ã€‚
index.htmlã§ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹jsã‚’èª­ã¿ã“ã‚“ã§ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€ç›´ä¸‹ã®openapi/ã«ã‚ã‚‹yamlã‚’èª­ã‚€è¨­å®šã«ã—ãŸã€‚

ä»¥ä¸‹ã¯æ¤œè¨¼ãƒ„ãƒ¼ãƒ«ã§ç¢ºèªã—ãŸindex.html
ä¸‹éƒ¨ã§jsã‚„yamlã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‹
```html:index.html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ReDoc</title>
    <link rel="icon" href="favicon.png" />
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      redoc {
        display: block;
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:300,400,700"
      rel="stylesheet"
    />
  </head>

  <body>
    <redoc spec-url="./openapi/api.yaml" ></redoc>
    <script src="redoc.standalone.js"></script>
  </body>
</html>

```

## å‚è€ƒï¼šconfigmap

```yaml:configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: api-openapi-docs
data:
  api.yaml: |
    openapi: 3.0.0
    info:
(ç•¥)
```
