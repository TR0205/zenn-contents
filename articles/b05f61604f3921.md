---
title: "ã€GitLab CIã€‘Laravelã®CI/CDå®Ÿè¡Œæ™‚é–“çŸ­ç¸®"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GitLab", "GitLab CI", "Docker", "Laravel"]
published: true
---

# æ¦‚è¦
æ¥­å‹™ã§Laravelã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®CI/CDå®Ÿè¡Œæ™‚é–“çŸ­ç¸®ã‚’è¡Œãªã£ãŸãŸã‚ã€èª¿æŸ»å†…å®¹ãªã©ã‚„å¯¾å¿œã«ã¤ã„ã¦ã¾ã¨ã‚ã‚‹ã€‚

# æ§‹æˆ
Laravelã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘DBã¸ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã€å¾Œç¶šã®MicroserviceãŒå–å¾—ã—å‡¦ç†ã‚’è¡Œã†ã‚ˆã†ãªæ§‹æˆ(è©³ç´°ã¯å‰²æ„›)ã€‚
![](https://storage.googleapis.com/zenn-user-upload/9153bbd96937-20241213.png)

DBã¯laravelã¨ã¯åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã€‚git submoduleã‚’ä½¿ç”¨ã—ã¦å¤‰æ›´ã‚’å–ã‚Šè¾¼ã¿ã€docker composeã§postgresã‚³ãƒ³ãƒ†ãƒŠã¸ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„é–‹ç™ºã‚’è¡Œã†ã€‚

ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ã¯DockerHubã‚’ä½¿ç”¨ã€‚

```yml:compose.yml
services:
  php:
  (ç•¥)
  postgres:
    image: postgres
  (ç•¥)
  migration:
    depends_on:
      - postgres
```

# å¾“æ¥ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
å¾“æ¥ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ä»¥ä¸‹ã®é †ã«å®Ÿè¡Œã•ã‚Œã¦ã„ãŸã€‚
:::message
docker loginã‚„variablesã®å®šç¾©ãªã©è«¸ã€…çœç•¥
:::

```yaml
.setup_db:
  stage: setup
  variables:
    POSTGRES_PORT: 5432
    POSTGRES_USER: "root"
    POSTGRES_PASSWORD: "password"
    DBNAME: "dbname"
  before_script:
    - |
      docker run \
        -e POSTGRES_ADDRESS="${POSTGRES_ADDRESS}" \
        -e POSTGRES_PORT \
        -e POSTGRES_USERNAME="${POSTGRES_USER}" \
        -e POSTGRES_PASSWORD \
        -e POSTGRES_DBNAME="${DBNAME}" \
        example/migration:latest

test:
  stage: test
  services:
    - docker:24.0.5-dind
    - postgres:15.2-alpine3.17
  extends: .setup_db
  script:
    - docker build  --target development -t test -f docker/php/Dockerfile .
    - |
      docker run -t -v $(pwd):/workspace test sh -ec " \
      composer install && \
      ./vendor/bin/phpstan analyse --memory-limit=1G && \
      php artisan test --parallel --processes=8"

build-and-push:
  image: docker:latest
  stage: build
  variables:
    DOCKER_TLS_CERTDIR: "/certs"
  services:
    - docker:dind
  before_script:
    - docker login -u "${CI_REGISTRY_USER}" -p "${CI_REGISTRY_PASSWORD}" "${CI_REGISTRY}"
  script:
    - docker build -f docker/php/Dockerfile --progress=plain -t exmple/api:latest .
    - docker push exmple/api:latest

```

## å„ã‚¸ãƒ§ãƒ–ã«ã¤ã„ã¦
### .setup_db
åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã—å®Ÿè¡Œã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚å¾Œç¶šã®ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–å†…servicesã§å®šç¾©ã—ãŸpostgresã‚³ãƒ³ãƒ†ãƒŠã¸ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã€‚

### test
Dockerfileã‚’ä½¿ç”¨ã—ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰å¾Œã€docker runã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€‚

### build-and-push
Dockerfileã‚’ä½¿ç”¨ã—ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰å¾Œã€DockerHubã¸ãƒ—ãƒƒã‚·ãƒ¥ã€‚

## å•é¡Œç‚¹
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å®Ÿè¡Œæ™‚é–“ãŒé•·ã„ã€‚é€šå¸¸ã®é–‹ç™ºæ™‚ã¯ãƒ†ã‚¹ãƒˆå‰ã®ãƒ“ãƒ«ãƒ‰ã®ã¿å®Ÿè¡Œã—ã¦ã„ãŸãŸã‚8åˆ†ã»ã©ã€ãƒªãƒªãƒ¼ã‚¹æ™‚ã«DockerHubã¸ã®build&pushã‚’è¡Œã†ã¨14åˆ†ã»ã©ã‹ã‹ã‚‹ã€‚ç†ç”±ã‚’ä»¥ä¸‹ã«æ•´ç†ã€‚

### vendor/ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ããªã„
```yaml
default:
  image: php:latest
  cache:  # Cache libraries in between jobs
    key: $CI_COMMIT_REF_SLUG
    paths:
      - vendor/
  before_script:
    # Install and run Composer
    - curl --show-error --silent "https://getcomposer.org/installer" | php
    - php composer.phar install

test:
  script:
    - vendor/bin/phpunit --configuration phpunit.xml --coverage-text --colors=never
```
å…¬å¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ã¯ã‚¸ãƒ§ãƒ–ã®imageã«PHPã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã€cacheã«ã‚ˆã£ã¦vendorãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ã„ã‚‹ã€‚
ã—ã‹ã—ã€ç¾çŠ¶æ§‹æˆã®docker runã§composer installã‚’å®Ÿè¡Œã™ã‚‹ã¨cacheã¯åˆ©ç”¨ã§ããªã„ã€‚ãã®ãŸã‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã³ã«composer installãŒå®Ÿè¡Œã•ã‚Œæ™‚é–“ãŒã‹ã‹ã‚‹ã€‚

https://docs.gitlab.com/ee/ci/caching/#cache-php-dependencies

### ãƒ“ãƒ«ãƒ‰ã‚’ï¼’å›å®Ÿè¡Œ
ãƒ†ã‚¹ãƒˆã¨Dockerhubã¸ã®build&pushã§ï¼’å›ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚ãã®ä¸Šã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚åˆ©ç”¨ã—ã¦ã„ãªã„ãŸã‚æ™‚é–“ãŒã‹ã‹ã‚‹ã€‚
ä»Šå›ã®ä¾‹ã§ã¯ä¸€åº¦ã®ãƒ“ãƒ«ãƒ‰ã§5åˆ†è¿‘ãã‹ã‹ã£ã¦ã„ãŸãŸã‚ã€ãƒ“ãƒ«ãƒ‰ã ã‘ã§10åˆ†è¦ã—ã¦ã„ãŸã€‚

ä»¥å‰ã¯ãƒ†ã‚¹ãƒˆæ™‚ã®ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã‚ãšã€ã‚¸ãƒ§ãƒ–ã®image:ã«PHPã‚’æŒ‡å®šã—ã¦ã„ãŸã€‚ã—ã‹ã—ã€ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰ã®ãŸã‚ã«PHPã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã€ŒDockerfileã«è¨˜è¼‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã»ã¼åŒæ§˜ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ orå‰Šé™¤æ™‚ã®éš›ã«Dockerfileã¨.gitlab-ci.ymlã‚’ç·¨é›†ã—ãªã‘ã‚Œã°ãªã‚‰ãšé¢å€’ã ã£ãŸãŸã‚ã€ç¾åœ¨ã®å½¢ã¨ãªã£ãŸã€‚

# å¯¾å¿œçµæœ
ä¸Šè¨˜ã®å•é¡Œç‚¹ã‚’æ”¹å–„ã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£æ±ºå®šã€‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ä»¥ä¸‹ã®æµã‚Œã€‚

:::message
docker loginã‚„variablesã®å®šç¾©ãªã©è«¸ã€…çœç•¥
:::

```yaml
stages:
  - setup
  - build
  - test
  - push

# DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—çµæœã‚’ãƒ€ãƒ³ãƒ—ã€å¾Œç¶šã®testã‚¸ãƒ§ãƒ–ã¸artifactã¨ã—ã¦æ¸¡ã™
db_setup:
  stage: setup
  image: docker:latest
  services:
    - name: postgres:15.2-alpine3.17
      alias: postgres
    - name: docker:dind
      alias: dind
  script:
    - |
      docker run --network=host --rm \
        -e POSTGRES_ADDRESS="postgres" \
        -e POSTGRES_PORT="${POSTGRES_PORT}" \
        -e POSTGRES_USERNAME="${POSTGRES_USER}" \
        -e POSTGRES_PASSWORD="${POSTGRES_PASSWORD}" \
        -e POSTGRES_DBNAME="${DBNAME}" \
        example/migration:latest
    # pg_dumpã§ãƒ€ãƒ³ãƒ—ã™ã‚‹ãŸã‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ 
    - apk add --no-cache postgresql-client
    # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†…å®¹ã‚’ãƒ€ãƒ³ãƒ—
    - PGPASSWORD="${POSTGRES_PASSWORD}" pg_dump -h postgres -U "${POSTGRES_USER}" -d "${DBNAME}" > test_db.sql
  artifacts:
    # ãƒ€ãƒ³ãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’1æ™‚é–“ä¿æŒ
    paths:
      - test_db.sql
    expire_in: 1 hour

build:
  image: docker:latest
  services:
    - name: docker:dind
      alias: dind
  variables:
    DOCKER_FILE: ".infrastructure/Dockerfile"
    DOCKER_TLS_CERTDIR: "/certs"
  before_script:
    - docker login -u "${CI_REGISTRY_USER}" -p "${CI_REGISTRY_PASSWORD}" "${CI_REGISTRY}"
  script:
    - echo exmple/api:latest
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’pullã€å¤±æ•—ã—ã¦ã‚‚å‡¦ç†ã‚’ç¶šã‘ã‚‹
    - docker pull exmple/api:latest || true
    - docker buildx build --build-arg BUILDKIT_INLINE_CACHE=1 --cache-from exmple/api:latest -f "${DOCKER_FILE}" -t exmple/api:"${CI_COMMIT_SHORT_SHA}" .
    - docker push exmple/api:"${CI_COMMIT_SHORT_SHA}"

test:
  stage: test
  image: "exmple/api:$CI_COMMIT_SHORT_SHA"
  services:
    - name: postgres:15.2-alpine3.17
      alias: postgres
  dependencies:
    - migration
  script:
    # DBä½œæˆ
    - PGPASSWORD="${POSTGRES_PASSWORD}" psql -h postgres -U "${POSTGRES_USER}" -c "CREATE DATABASE ${DBNAME};"
    # migrationã‚¸ãƒ§ãƒ–ã§ãƒ€ãƒ³ãƒ—ã—ãŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨
    - PGPASSWORD="${POSTGRES_PASSWORD}" psql -h postgres -U "${POSTGRES_USER}" -d "${DBNAME}" < test_job.sql
    # CIã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã®ã¿DBã®æ¥ç¶šè¨­å®šã‚’ä¸Šæ›¸ã
    - sed -i "/^POSTGRES_ADDRESS=/c\POSTGRES_ADDRESS=${POSTGRES_ADDRESS}" .env.testing
    # ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    - composer install
    # é™çš„è§£æ
    - ./vendor/bin/phpstan analyse --memory-limit=1G
    # å˜ä½“ãƒ†ã‚¹ãƒˆã€APIãƒ†ã‚¹ãƒˆã€OpenAPIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    - php artisan test --parallel --processes=8
  cache:
    key:
      # composer.lockã«å¤‰æ›´ãŒãªã„å ´åˆã¯åŒä¸€ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåˆ©ç”¨ã•ã‚Œã‚‹
      files:
        - composer.lock
    paths:
      - vendor/
  tags:
    - docker

push:
  image: docker:latest
  services:
    - name: docker:dind
      alias: dind
  variables:
    DOCKER_TLS_CERTDIR: "/certs"
  before_script:
    - docker login -u "${CI_REGISTRY_USER}" -p "${CI_REGISTRY_PASSWORD}" "${CI_REGISTRY}"
  script:
    # ãƒ†ã‚¹ãƒˆå‰ã«buildã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’pull
    - docker pull exmple/api:"${CI_COMMIT_SHORT_SHA}"
    # ã‚¿ã‚°ä»˜ã‘ã—ã¦push
    - docker tag exmple/api:"${CI_COMMIT_SHORT_SHA}" exmple/api:latest
    - docker push exmple/api:latest


```

## build&pushã‚¸ãƒ§ãƒ–ã‚’åˆ†å‰²
build->test->pushã«åˆ†å‰²ã™ã‚‹ã€‚

æœ€åˆã®buildã§ã¯CI_COMMIT_SHORT_SHAã‚’ä½¿ç”¨ã—ãƒãƒƒã‚·ãƒ¥ã‚’ã‚¿ã‚°ã«ã¤ã‘ã¦ãƒ—ãƒƒã‚·ãƒ¥ã€‚testã‚¸ãƒ§ãƒ–ã®imageã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®šã€ãƒ†ã‚¹ãƒˆãŒé€šã£ãŸå ´åˆã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«ã—ã€latestç­‰ã®ã‚¿ã‚°ã‚’ä»˜ã‘å†åº¦ãƒ—ãƒƒã‚·ãƒ¥ã€‚

ã“ã®ã‚ˆã†ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã‚’ä¸€åº¦ã§æ¸ˆã¾ã›ã‚‹ã€‚

## testã‚¸ãƒ§ãƒ–ã®ã‚¤ãƒ¡ãƒ¼ã‚¸å¤‰æ›´
dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—docker runã§å®Ÿè¡Œã—ã¦ã„ãŸãƒ†ã‚¹ãƒˆã«ã¤ã„ã¦ã€ä¸Šè¨˜ã®buildã‚¸ãƒ§ãƒ–ã§ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹å½¢ã¸å¤‰æ›´ã€‚

composer installã‚’å®Ÿè¡Œå¾Œã®vendor/ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã€‚

# åŠ¹æœ
CIã®å®Ÿè¡Œæ™‚é–“ã®å¤§å¹…ãªçŸ­ç¸®ã«ã¤ãªãŒã£ãŸã€‚ç‰¹ã«ãƒªãƒªãƒ¼ã‚¹ä½œæ¥­æ™‚ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œæ™‚é–“ãŒ10åˆ†ã»ã©çŸ­ç¸®ã•ã‚ŒãŸã€‚

# æ¤œè¨ãƒ»èª¿æŸ»å†…å®¹

## servicesã¯ã‚¸ãƒ§ãƒ–é–“ã§å…±æœ‰ä¸å¯
å½“åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«servicesã‚’ã‚¸ãƒ§ãƒ–é–“ã§å…±æœ‰ã§ããªã„ã‹ã¨æ€ã£ãŸãŒä¸å¯èƒ½ã€‚

```yaml
db_setup:
  stage: setup
  image: docker:latest
  services:
    - name: postgres:15.2-alpine3.17
      alias: postgres

(ç•¥)

test:
  stage: test
  image: "exmple/api:$CI_COMMIT_SHORT_SHA"
  services:
    - name: postgres:15.2-alpine3.17
      alias: postgres
```

db_setupã‚¸ãƒ§ãƒ–ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã—testã‚¸ãƒ§ãƒ–ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚è€ƒãˆãŸãŒã€ãã®å ´åˆã¯testã‚¸ãƒ§ãƒ–ã§dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚ãã‚Œã§ã¯æ—¢å­˜ã¨å¤‰ã‚ã‚‰ãšã€vendor/ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ããªã„ã€‚

ãã®ãŸã‚ã€
- db_setupã‚¸ãƒ§ãƒ–ã§postgresã‚’serviceã¨ã—ã¦ä½¿ç”¨ã—ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
- ãƒ€ãƒ³ãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’artifactçµŒç”±ã§testã§æ¸¡ã™
- testã‚¸ãƒ§ãƒ–ã§æ–°ãŸãªpostgresã‚’servicesã¨ã—ã¦ä½¿ç”¨ã€ãƒ€ãƒ³ãƒ—ã‚’é©ç”¨

ã¨ã„ã†å½¢ã‚’ã¨ã£ãŸã€‚

## FF_NETWORK_PER_BUILDã¨network=host
servicesã®postgresã¸docker runã§å®Ÿè¡Œã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰æ¥ç¶šã™ã‚‹éš›ã«è¨­å®šãŒå¿…è¦ã€‚network=hostã‚‚å¿…è¦ã€‚ã„ãšã‚Œã‚‚ãƒãƒ‹ãƒ¥ã‚¢ãƒ«å‚ç…§ã€‚

```yml
access-service:
  stage: build
  image: docker:20.10.16
  services:
    - docker:dind                    # necessary for docker run
    - tutum/wordpress:latest
  variables:
    FF_NETWORK_PER_BUILD: "true"     # activate container-to-container networking
  script: |
    docker run --rm --name curl \
      --volume  "$(pwd)":"$(pwd)"    \
      --workdir "$(pwd)"             \
      --network=host                 \
      curlimages/curl:7.74.0 curl "http://tutum-wordpress"
```

https://docs.gitlab.com/ee/ci/services/?utm_source=chatgpt.com#using-services-with-docker-run-docker-in-docker-side-by-side

## ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆDockerHubãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®ã‚¤ãƒ¡ãƒ¼ã‚¸pull
DOCKER_AUTH_CONFIGã‚’CI/CD variablesã«ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ç”¨ã™ã‚‹èªè¨¼æƒ…å ±ã§docker loginã€‚($CI_REGISTRY_PASSWORDãªã©)
~/.docker/config.jsonã®ä¸­èº«ã‚’å–å¾—ã—ç™»éŒ²ã€‚

https://docs.gitlab.com/ee/ci/docker/using_docker_images.html#access-an-image-from-a-private-container-registry

## buildã‚¸ãƒ§ãƒ–ã§ä½¿ç”¨ã™ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°
latestã‚’æŒ‡å®šã—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä½¿ç”¨ã€‚

$CI_COMMIT_REF_SLUGã‚’ä½¿ç”¨ã—ãƒ–ãƒ©ãƒ³ãƒæ¯ã®æœ€æ–°ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ä½¿ç”¨ã™ã‚‹ã‹è¿·ã£ãŸãŒã€releaseã‚„featureã®ä¸€ç™ºç›®ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ã‹ãªã„ã®ã§è¦‹é€ã‚Šã€‚

mainã€releaseã€featureé–¢ä¿‚ãªãlatestã€‚ãã‚‚ãã‚‚Dockerfileã¸ã®å¤‰æ›´ã¯ãã“ã¾ã§é »ç¹ã«ç™ºç”Ÿã—ãªã„ãŸã‚ã€‚

# ãã®ä»–èª¿æŸ»
## Docker-in-Docker
```yml
image: docker:latest
```
ã®ã‚ˆã†ã«ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æŒ‡å®šã ã‘ã§ã¯dockerã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã§ããªã„ã€‚dindã‚µãƒ¼ãƒ“ã‚¹ã‚‚å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
https://gitlab-docs.creationline.com/ee/ci/docker/using_docker_build.html

# ã¾ã¨ã‚
Laravelã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’GitLab CIã§æ§‹ç¯‰ã™ã‚‹è¨˜äº‹ãŒå°‘ãªã™ãã‚‹ã€‚å…¬å¼ã‚‚å¤ã„ã—ã€‚
