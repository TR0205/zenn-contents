---
title: "ã€Laravelã€‘VSCodeä¸Šã§é™çš„è§£æã¨ã‚³ãƒ¼ãƒ‰æ•´å½¢ã‚’ã—ãªãŒã‚‰é–‹ç™ºã™ã‚‹ç’°å¢ƒã‚’æ•´ãˆãŸ"
emoji: "ğŸ˜½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["VS Code", "Laravel", "Laravel Pint", "Larastan", "PHPStan"]
published: true
---

# æ¦‚è¦

æ–°è¦ã® Laravel ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã™ã‚‹ã«ã‚ãŸã‚Šã€

- é™çš„è§£æ(Larastan)
- ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿(Laravel Pint)

ã‚’å°å…¥ã—ã¾ã—ãŸã€‚

VSCode ã§ç·¨é›†&ä¿å­˜å¾Œã™ãã«çµæœã‚’ç¢ºèªã§ãã‚‹ã“ã¨(ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™º ã® Eslint,Prettier ã¿ãŸã„ãªå½¢)ã‚’ç›®æ¨™ã¨ã—ã¾ã—ãŸã€‚

# ã‚„ã£ãŸã“ã¨

## æ‹¡å¼µæ©Ÿèƒ½ã®é¸å®šã«ã¤ã„ã¦

### é™çš„è§£æ

PHP ã®é™çš„è§£æãƒ„ãƒ¼ãƒ«ã«ã¯ã€ŒPhanã€PHPStanã€Psalmã€ãªã©ãŒã‚ã‚Šã¾ã™ã€‚
æœ€çµ‚çš„ãªç›®æ¨™ã¯ã€ŒLaravel ã®é™çš„è§£æã€ãªã®ã§ãã¡ã‚‰ã‹ã‚‰æ¢ã£ãŸã¨ã“ã‚ã€Larastan ãŒãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã®ã‚ˆã†ã§ã—ãŸã€‚

ã—ã‹ã— Larastan ã® VSCode æ‹¡å¼µã‚’æ¢ã—ã¦ã¿ãŸã¨ã“ã‚ã»ã¨ã‚“ã©å­˜åœ¨ã›ãšã€èª¿ã¹ã¦ã¿ãŸã¨ã“ã‚ä»¥ä¸‹ã® issue ãŒ PHPStan ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚Šã¾ã—ãŸã€‚
https://github.com/nunomaduro/larastan/issues/139

> You can use the one for PHPStan and just include larastan's extension.neon into your configuration.

ã€ŒPHPStan ã®æ‹¡å¼µã‚’ Larastan ã®è¨­å®šã§ä½¿ãˆã‚‹ã‚ˆã€ã£ã¦ã“ã¨ã ã£ãŸã®ã§ã€PHPStan ã®æ‹¡å¼µæ©Ÿèƒ½ã‚’å°å…¥ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

ã„ãã¤ã‹ã® PHPStan æ‹¡å¼µã®ä¸­ã§å•é¡Œãªãå‹•ä½œã—ãŸ[phpstan](https://marketplace.visualstudio.com/items?itemName=SanderRonde.phpstan-vscode)ã‚’é¸å®šã—ã¦ã„ã¾ã™ã€‚

### ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿

ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã«ã¯ Laravel å…¬å¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«ã‚‚è¨˜è¼‰ã®ã‚ã‚‹ Laravel Pint ã‚’é¸å®šã—ã¾ã—ãŸã€‚
VSCode ã®æ‹¡å¼µã¨ã—ã¦ã“ã¡ã‚‰ã‚‚ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒã€[Laravel Pint](https://marketplace.visualstudio.com/items?itemName=open-southeners.laravel-pint)ã‚’é¸å®šã—ã¦ã„ã¾ã™ã€‚

## Dev Container

**å¿…è¦ãªæ‹¡å¼µã‚’å¿…è¦ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¿å°å…¥ã™ã‚‹**ãŸã‚ã€VSCode æ‹¡å¼µã®[Dev Container](https://code.visualstudio.com/docs/devcontainers/containers)ã‚’å°å…¥ã—ã¾ã—ãŸã€‚

â€»Dev Container ã«ã¤ã„ã¦ã®ã‚ã‹ã‚Šã‚„ã™ã„èª¬æ˜ã¯ä»¥ä¸‹
https://blog.kinto-technologies.com/posts/2022-12-10-VSCodeDevContainer/

.devcontainer ã‚’ç·¨é›†ã—ã€é™çš„è§£æãªã©ã§ä½¿ç”¨ã™ã‚‹æ‹¡å¼µæ©Ÿèƒ½ã‚’å®šç¾©ã—ã¾ã™ã€‚

### .devcontainer

VSCode ã‹ã‚‰æ“ä½œã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®å®šç¾©ã‚’è¡Œã„ã¾ã™ã€‚

```json:devcontainer.json
{
    "name": "Laravelã‚¢ãƒ—ãƒª",
    "dockerComposeFile": [
        "../compose.yml"
    ],
    "service": "app",
    "workspaceFolder": "/workspace",
    "forwardPorts": [
        9000
    ],
    "customizations": {
        "vscode": {
            "extensions": [
                "open-southeners.laravel-pint",
                "SanderRonde.phpstan-vscode"
            ],
            "settings": {
                "editor.tabSize": 4,
                "editor.formatOnSave": true,
                "editor.defaultFormatter": "open-southeners.laravel-pint",
                "phpstan.binPath": "vendor/bin/phpstan",
                "phpstan.timeout": 1000000,
            }
        }
    },
    "mounts": [
        "source=vendor-store,target=/workspace/vendor,type=volume"
    ]
}

```

#### settings ã¸ Dev Container å†…ã§ã®è¨­å®šã‚’è¿½åŠ 

editor.formatOnSave ã‚’ true ã¨ã—ã€editor.defaultFormatter ã« Laravel Pint æ‹¡å¼µã‚’å®šç¾©

#### mounts ã§åå‰ä»˜ããƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å®šç¾©ã™ã‚‹

- é€šå¸¸ã€Dev Container ä¸Šã§ PHPStan æ‹¡å¼µã‚’å‹•ã‹ãã†ã¨ã™ã‚‹ã¨**ã‹ãªã‚Šé‡ããªã‚‹**ãŸã‚è¨­å®š(è§£æã« 30 ç§’ã»ã©)
- compose.yml ã§ã®è¨­å®šã‚‚å¿…è¦(å¾Œè¿°)
- å‚è€ƒï¼šhttps://code.visualstudio.com/remote/advancedcontainers/improve-performance
- ã“ã®è¨­å®šã‚’ã—ãŸå¾Œã¯ãƒ­ãƒ¼ã‚«ãƒ«ã® vendor ä»¥ä¸‹ã‚’å‰Šé™¤ã—ã¦ Dev Container ã‚’ç«‹ã¡ä¸Šã’ã¦ç¢ºèªã™ã‚‹
  - VSCode ä¸Šã§ã€Œvendor/bin/phpstan ãŒãªã„ã€ã¨ã„ã†ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ composer install ã‚’å®Ÿè¡Œã™ã‚‹
  - composer install ã«ã‚ˆã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã® vendor ä»¥ä¸‹ã«ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œãªã„(åå‰ä»˜ããƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å®šç¾©ã—ã¦ã„ã‚‹ãŸã‚)

#### phpstan.timeout ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤(10000)ã‚’ä¸Šã’ã‚‹

mounts ã‚’å®šç¾©ã—ã¦ã‚‚ãªãŠé‡ãã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¦ã—ã¾ã£ãŸãŸã‚(ã„ãšã‚Œä½•ã¨ã‹ã—ãŸã„)

### compose.yml

```yml:compose.yml
version: '3.8'

volumes:
  vendor-store:

services:
  app:
    volumes:
      - type: bind
        source: ./
        target: /workspace
      - type: volume
        source: vendor-store
        target: /workspace/vendor
```

.devcontainer ã® mounts ã§å®šç¾©ã—ã¦ã„ãŸ source=vendor-store ã‚’ volumes ã«å®šç¾©ã™ã‚‹

### PHPStan è¨­å®š

```
includes:
    - ./vendor/nunomaduro/larastan/extension.neon

parameters:

    paths:
        - app
        - routes

    # Level 9 is the highest level
    # Check type hinting
    level: 6

    parallel:
        maximumNumberOfProcesses: 1

    checkGenericClassInNonGenericObjectType: false

```

#### è§£æãƒ¬ãƒ™ãƒ«

PHPStan ã§ã¯è§£æã®ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»Šå›ã¯æ–°è¦ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§ãªã‚‹ã¹ãå‹å®šç¾©ã‚’å³ã—ãè¨­å®šã—ãŸã„ãŸã‚ã€Level6 ã‚’è¨­å®šã—ã¾ã—ãŸã€‚
â€»level5 ä»¥ä¸‹ã¯å‹å®šç¾©ã‚’è¨­å®šã—ãªãã¦ã‚‚å¯ã§ã™ã€‚

#### ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œ

PHPStan ã¯ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã¨ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚
ã‚¹ãƒšãƒƒã‚¯ãŒä½ã„å ´åˆã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ–¹ãŒåŠ¹ç‡ãŒã‚ˆã„ã‹ã‚‚ï¼Ÿã¨ã®ã“ã¨ã§ã“ã¡ã‚‰ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚
(ä½“æ„Ÿæ—©ããªã£ãŸæ°—ã‚‚ã™ã‚‹ãŒã€æ­£ç¢ºã«æ¸¬å®šã¯ã—ã¦ã„ãªã„ã®ã§å¾Œã§æ¤œè¨¼ã—ãŸã„)
https://lazesoftware.com/ja/blog/230405/

## æ‹¡å¼µæ©Ÿèƒ½ãŒå‹•ã‹ãªã„å ´åˆ

![](https://storage.googleapis.com/zenn-user-upload/47e065d8ebcd-20230713.png)
ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã€OUTPUT ã‚¿ãƒ–ã‚’é¸æŠã—ã¾ã™ã€‚
å³ã®ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰æ‹¡å¼µæ©Ÿèƒ½ã‚’é¸æŠã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒåã‹ã‚Œã¦ã„ã‚‹ã®ã§ã€ç¢ºèªã™ã‚‹ã¨å¤§æŠµè§£æ±ºã—ã¾ã™ã€‚
(å¤§ä½“è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šãƒ‘ã‚¹ãŒé–“é•ã£ã¦ã‚‹ã¨ã‹ãã‚“ãªæ„Ÿã˜)

# ã¾ã¨ã‚

ã¾ã é‹ç”¨ã—å§‹ã‚ãŸã°ã‹ã‚Šã®ãŸã‚æ”¹å–„ç‚¹ã¯ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ä¸€æ—¦ã“ã®å½¢ã§é–‹ç™ºã—ã¦ã„ã£ã¦ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã—ã¦ã„ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

æ‹¡å¼µæ©Ÿèƒ½ã«ã¤ã„ã¦ã§ã™ãŒã€åŸºæœ¬çš„ã« Github ã‚¹ã‚¿ãƒ¼ã‚‚å°‘ãªããƒ¡ãƒ³ãƒ†ã‚‚ã‚ã¾ã‚Šã•ã‚Œã¦ã„ãªã„ã‚¤ãƒ¡ãƒ¼ã‚¸ãªã®ã§ã€**CI ä¸Šã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®è£œåŠ©çš„ãªä½ç½®ã¥ã‘**ã§ä½¿ç”¨ã§ãã‚Œã°ã„ã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

ä½™è«‡ã§ã™ãŒã€ã€ŒVSCode ä¸Šã§ Laravel ã®é™çš„è§£æã‚’ã™ã‚‹ã€ã¿ãŸã„ãªè¨˜äº‹ãŒå°‘ãªã„ãªã¨æ„Ÿã˜ã¾ã—ãŸã€‚
PHPStorm ã§ã¯ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³ã¨ã‹ã„ã†æ©Ÿèƒ½ã§è¨­å®šã§ãã‚‹ã£ã½ã„ã§ã™ãŒã€PHPer ã¯ã¿ã‚“ãª VSCode ã‚’ä½¿ã£ã¦ã„ãªã„ã®ã‹ãªãƒ»ãƒ»ãƒ»ã¨æ„Ÿã˜ã¾ã—ãŸã€‚
https://pleiades.io/help/phpstorm/running-inspections.html

# èª¿æŸ»æ™‚ã«ä½œæˆã—ãŸã‚¹ã‚¯ãƒ©ãƒƒãƒ—

https://zenn.dev/tusi/scraps/b96773894ea5f6
https://zenn.dev/tusi/scraps/474375c4242f33
